@{
    var userLogic = EPAM.Task6._01_Users.Common.DependencyResolver.UserLogic;
    userLogic.LoadUserList();
    userLogic.LoadAwardList();
    var users = userLogic.GetAll();
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="~/Style.css" />
    <script src="~/JavaScript.js"></script>
    <title></title>
</head>
<body>
    <div class="container">
        <div class="userList">
            <h2>Users and Awards</h2>
            <ul>
                @foreach (var user in users)
                {
                    <li>@user.ToString()</li>
                }
            </ul>
        </div>
        <div class="buttons">
            <button id="addUser" type="submit" onclick="AddUserMenu()">Add User</button>
            <button id="editUser" type="submit" onclick="EditUserMenu()">Edit User</button>
            <button id="addAward" type="submit" onclick="AddAwardMenu()">Add Award</button>
            <button id="removeAward" type="submit" onclick="RemoveAwardMenu()">Remove Award</button>
            <button id="removeUser" type="submit" onclick="RemoveUserMenu()">Remove User</button>
        </div>
        <div class="forms">
            <form id="addUserMenu" action="~/ViewPage1.cshtml" method="post">
                @if (IsPost && !Request.Params["addFirstName"].IsEmpty())
                {
                    string addFirstName = Request.Params["addFirstName"].ToLower();
                    string addLastName = Request.Params["addLastName"].ToLower();
                    DateTime addBirthDate;

                    if (DateTime.TryParse(Request.Params["addBirthDate"], out addBirthDate))
                    {
                        var newUser = new EPAM.Task6._01_Users.Entities.User
                        {
                            FirstName = addFirstName,
                            LastName = addLastName,
                            DateOfBirth = addBirthDate,
                        };
                        userLogic.AddUser(newUser);
                        @:<script>window.location.replace("/ViewPage1.cshtml")</script>
                    }
                }
            </form>
            <form id="editUserMenu" action="~/ViewPage1.cshtml" method="post">
                @if (IsPost && (!Request.Params["editFirstName"].IsEmpty() || !Request.Params["editLastName"].IsEmpty() || !Request.Params["editBirthDate"].IsEmpty()))
                {

                    if (int.TryParse(Request.Params["editId"], out int editId))
                    {
                        string editFirstName = Request.Params["editFirstName"].ToLower();
                        string editLastName = Request.Params["editLastName"].ToLower();
                        string editBirthDate = Request.Params["editBirthDate"];
                        userLogic.EditUser(editId, editFirstName, editLastName, editBirthDate);
                        @:<script>window.location.replace("/ViewPage1.cshtml")</script>
                    }
                }
            </form>
            <form id="removeUserMenu" action="~/ViewPage1.cshtml" method="post">
                @if (IsPost && !Request.Params["removeId"].IsEmpty())
                {
                    char[] div = { '.', ',', ' ' };
                    string[] removeIdList = Request.Params["removeId"].Split(div, StringSplitOptions.RemoveEmptyEntries);
                    foreach (var id in removeIdList)
                    {
                        userLogic.Remove(Convert.ToInt32(id));
                    }
                    @:<script>window.location.replace("/ViewPage1.cshtml")</script>
                }
            </form>
            <form id="addAwardsMenu" action="~/ViewPage1.cshtml" method="post">
                @if (IsPost && !Request.Params["addAwardTitle"].IsEmpty())
                {
                    string awardTitle = Request.Params["addAwardTitle"].ToLower();
                    {
                        var newAward = new EPAM.Task6._01_Users.Entities.Award
                        {
                            Title = awardTitle,
                        };
                        try
                        {
                            userLogic.AddAward(newAward);
                            char[] div = { '.', ',', ' ' };
                            string[] addAwardIdList = Request.Params["addAwardId"].Split(div, StringSplitOptions.RemoveEmptyEntries);
                            foreach (var id in addAwardIdList)
                            {
                                userLogic.AddAwardToUser(Convert.ToInt32(id), newAward);
                            }
                            @:<script>window.location.replace("/ViewPage1.cshtml")</script>
                        }
                        catch (ArgumentException)
                        {
                            @:<script>alert("This award already exist")</script>
                        }

                    }
                }
            </form>
            <form id="removeAwardsMenu" action="~/ViewPage1.cshtml" method="post">
                @if (IsPost && !Request.Params["removeAwardTitle"].IsEmpty())
                {
                    string removeAwardTitle = Request.Params["removeAwardTitle"];
                    userLogic.RemoveAward(removeAwardTitle);
                    @:<script>window.location.replace("/ViewPage1.cshtml")</script>
                }
            </form>
        </div>
    </div>
</body>
</html>